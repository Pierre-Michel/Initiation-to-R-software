---
title: "Initiation to R software Session VI"
author: "Pierre Michel"
date: "Master AMSE 1st year, 2019"
output:
  beamer_presentation: default
  ioslides_presentation: 
    transition: slower
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Statistics in R

## Introduction: statistics in R

Functions available for statistical analysis:

- Package `stats`: functions for classical statistical analysis (hypotheses tests, linear models, distributions, statistical summary, time series, multivariate analyses). It is loaded when R starts. USe `library(help = "stats")`
- Specific packages: other packages available  for statistical methods, distributed with R or downloadable: `class` (for classification), `boot` (for bootstrap), `survival` (for survival analysis)...

## Introduction: statistical modelling

Functions from `stats` for **statistical modelling**:

```{r, echo=F, eval=T, warning=F}
knitr::kable(data.frame(function_name = c("SSlogis", "aov", "glm", "lm", "manova", "ksmooth", "step"),
                        description = c("Logistic model", "Analysis of variance", "Generalized linear models", "Linear models", "Mutivariate analysis of variance", "Kernel smoother regression", "Model selection with Stepwise algorithm")))
```

## Introduction: statistical tests

Functions from `stats` for **statistical tests**:

```{r, echo=F, eval=T, warning=F}
knitr::kable(data.frame(function_name = c("bartlett.test", "binom.test", "chisq.test", "cor.test", "t.test", "var.test", "wilcox.test", "ks.test"),
                        description = c("Bartlett's variances homogeneity test", "Exact binomial test", "Chi2 test", "Correlation test", "Student's means comparison t-Test", "Fisher's variances comparison F-test", "Wilcoxon's rank test", "Kolmogorov-Smirnov's test")))
```

## Introduction: estimation and data analysis

Functions for **estimation**:

```{r, echo=F, eval=T, warning=F}
knitr::kable(data.frame(function_name = c("density", "ecdf"),
                        description = c("Kernel density estimation", "Empirical cumulative distribution function")))
```

Functions for **data analysis**:

```{r, echo=F, eval=T, warning=F}
knitr::kable(data.frame(function_name = c("hclust", "kmeans", "princomp", "dist"),
                        description = c("Hierarchical clustering", "Partitioning clustering", "Principal components analysis", "Computes distance matrices")))
```


# Formulas

## Formulas: syntax

Many statistical functions use formulas: `function(formula, data, ...)`

- `formula` of type `response ~ predictors`
- `data` data table containing the variables in `formula`

`response` is the target variable, `predictors` is the set of predictor variables, separated by arithmetic symbols.

## Formulas: examples

- `y~a`: predictor `a`
- `y~a+b`: predictors `a` and `b`
- `y~M`: as many models as predictors in `M` (matrix)
- `y~x-1`: model without intercept
- `y~log(b)`: predictor `log(b)`
- `y~a+I(b+c)`: predictors `a` and `b+c`
- `y~a:b`: interaction of `a` and `b`
- `y~a*b:a+b+a:b`: main effects and interaction of `a` and `b`
- `y~(a+b)^2`: main effects `a` and `b` and second-order interaction of `a+b+a:b`
- `y~a*b-a:b`: `a+b`

## Formulas: examples with formulas

_Example 1_: Simple linear regression of $y$ on $x$ ($x$ and $y$ quantitative).
```{r, echo = T, eval = T}
x=sample(1:10,200,replace=TRUE)
y=3+7*x+rnorm(200,0,100)
linreg=lm(y~x)
```

_Example 2_: Multivariate linear regression of fertility on education and infant mortality (all variables quantitative).
```{r, echo = T, eval = T}
data(swiss)
mlinreg = lm(Fertility~Education+Infant.Mortality,swiss)
```

_Example 3_: 1-factor analysis of variance: analyze the effect of a bug spray (6 different types) on the number of insects (count), based on the observation of 12 cultures sprayed succesively with the bug sprays. The response is qualitative.
```{r, echo = T, eval = T}
data(InsectSprays)  
anova = aov(sqrt(count) ~ spray, data = InsectSprays)
```

## Formulas: examples without formulas

_Example 4_: $\chi^2$-test to test the relation between qualitative variables $X$ and $Y$, based on a sample in the form of a contengency table.
```{r, echo = T, eval = T}
O = matrix(c(442,514,38,6),nrow=2,byrow=TRUE)
colnames(O) = c("male","female"); 
rownames(O) = c("sighted","blind") 
X2 = chisq.test(O,correct=FALSE) 
```

_Example 5_: Student's $t$-test to test the equality between two means, based on a sample of each subpopulation $X = (X_1,..,X_{n_1})$ and  $Y = (Y_1,..,Y_{n_2})$
```{r, echo = T, eval = T}
x = rnorm(100,1,1); y = rexp(200,1)
st = t.test(x,y) 

x = rnorm(100,1,1); z = rep(c(T,F),50)             
st2 = t.test(x~z)
```


# Outputs

## Outputs: Linear regression (`lm()`)

```{r, echo = F, eval = T}
x=sample(1:10,200,replace=TRUE)
y=3+7*x+rnorm(200,0,100)
linreg=lm(y~x)

data(swiss)
mlinreg = lm(Fertility~Education+Infant.Mortality,swiss)

data(InsectSprays)  
anova = aov(sqrt(count) ~ spray, data = InsectSprays)

O = matrix(c(442,514,38,6),nrow=2,byrow=TRUE)
colnames(O) = c("male","female"); 
rownames(O) = c("sighted","blind") 
X2 = chisq.test(O,correct=FALSE) 

x = rnorm(100,1,1); y = rexp(200,1)
st = t.test(x,y) 

x = rnorm(100,1,1); z = rep(c(T,F),50)             
st2 = t.test(x~z)
```

```{r, echo = T, eval = T}
linreg
```

## Outputs: Multivariate linear regression (`lm()`)

```{r, echo = T, eval = T}
mlinreg
```

## Outputs: Analysis of variance (`aov()`)

```{r, echo = T, eval = T}
anova
```

## Outputs: $\chi^2$-test (`chisq.test()`)

```{r, echo = T, eval = T}
X2
```

## Outputs: Student's $t$-test (`t.test()`)

```{r, echo = T, eval = T}
st
```

## Outputs: Student's $t$-test (`t.test()`)

```{r, echo = T, eval = T}
st2
```

## Outputs

In R, statistical functions return an object of class inherited from the name of the function (e.g\ `aov()` return an object of class `aov`, `lm()` returns an object of class `lm`, tests return objects of class `htest`). 

The returned object contains the results of the analysis. This is generally a list, whose displayed results depend on its class (e.g\ `aov()` and `lm()` do not provide the same lists). 

The elements in the list-object can be printed using `attributes()` and `names()`.

## Outputs: Linear regression and ANOVA

```{r, echo = T, eval = T}
names(linreg)
names(anova)
```

## Outputs: $\chi^2$-test

```{r, echo = T, eval = T}
attributes(X2)
```

## Outputs: Simple/Multivariate linear regression

```{r, echo = T, eval = T}
coefficients(mlinreg) # or mlinreg$coefficients
residuals(linreg) # or linreg$residuals
```

## Outputs: $\chi^2$-test

```{r, echo = T, eval = T}
X2$expected # theoretical counts
X2$residuals # residuals (theoretical - observed)
sum(X2$residuals^2) # Khi2 statistic value
```
# Generic functions

## Generic functions

Some functions are also used to extract the desired results: the **generic functions**.

They work specifically, according to the object class. 

Generic functions have a **single syntax** for all cases.

## Generic functions

- `print()` returns a short summary of the analysis.
- `summary()` returns a detailed summary of the analysis.
- `df.residuals()` returns the number of degrees of freedom of residual.
- `coef()` returns the estimated coefficients (sometimes with standard errors).
- `residuals()` returns the residuals.
- `fitted()` returns values predicted by the model.
- `logLik()` computes the log-likelihood and the number of parameters of a model.
- `AIC()` computes Akaike's information criterion.
- `anova()` table of analysis of variance.
- `plot()` returns a plot adapted to the analysis. 

## Generic functions: `summary()`

`summary()` prints a detailed summary of the analysis, specific to the object class.

```{r, echo = T, eval = T}
apropos("^summary")
```

## Generic functions: `summary()`

```{r, echo = T, eval = T}
summary(linreg)
```

## Generic functions: `summary()`

```{r, echo = T, eval = T}
summary(anova)
```

## Generic functions: `plot()`

`plot()` returns graphics adapted to the current analysis.

```{r, echo = T, eval = T}
apropos("^plot")
```

## Generic functions: `plot()`

```{r, echo = T, eval = T}
par(mfrow = c(2,2))
plot(anova)
```

